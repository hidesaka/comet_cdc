<!DOCTYPE html>
<html lang="ja">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>COMET CDC Wire Stringing</title>
      <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
      <link href="css/wire.css" rel="stylesheet" type="text/css" />
      <link href='//fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
      <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js" type="text/javascript"></script>
      <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.9.3/lodash.min.js" type"text/javascript"></script>
      <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" type="text/javascript"></script>
      <script src="//sdk.amazonaws.com/js/aws-sdk-2.1.34.min.js" type="text/javascript"></script>
      <script src="js/wire.js" type="text/javascript"></script>
      <script src="js/zip.js/WebContent/zip.js" type="text/javascript"></script>
      <script src="js/zipjs_wrapper.js" type="text/javascript"></script>
      <script src="js/file-upload.js" type="text/javascript"></script>
   </head>
   <body>

      <section class="container">
      <div>
         <h3>COMET CDC Wire Stringing</h3>
      </div>

      <ul class="nav nav-tabs">
         <li class="active"><a href="#menu_shift" data-toggle="tab">Shift Calendar</a></li>
         <li><a href="#menu_status" data-toggle="tab">Status</a></li>
         <li><a href="#menu_progress" data-toggle="tab">Progress</a></li>
         <li><a href="#menu_tension" data-toggle="tab">Tension</a></li>
         <li><a href="#menu_endplate" data-toggle="tab">Endplate</a></li>
         <li><a href="#menu_files" data-toggle="tab">Files</a></li>
         <li><a href="#menu_upload" data-toggle="tab">Upload</a></li>
      </ul>

      <div class="tab-content">
         <div class="tab-pane fade in active" id="menu_shift">
            <br>
            <a href="//prism.phys.sci.osaka-u.ac.jp/~hisataka/cdc/wire_string/shift_schedule.pdf">shift_schedule.pdf</a>
            <br>
            <br>
            <iframe src="https://www.google.com/calendar/embed?showTitle=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;height=600&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=comet.cdc.construction%40gmail.com&amp;color=%231B887A&amp;ctz=Asia%2FTokyo" style=" border-width:0 " width="800" height="600" frameborder="0" scrolling="no"></iframe>
         </div>
         <div class="tab-pane fade" id="menu_status">
            <div id="status"></div>
         </div>
         <div class="tab-pane fade" id="menu_progress">
            <div id="last_day"></div>
            <div id="progress_sum"></div>
            <div id="progress_ave"></div>
            <div id="progress_day"></div>
            <div id="bad_wires"></div>
            <div id="layer_days"></div>
         </div>
         <div class="tab-pane fade" id="menu_tension">
         </div>
         <div class="tab-pane fade" id="menu_endplate">
            <div id="menu_gauge"></div>
            <div id="menu_load_all"></div>
            <div id="menu_load_wire"></div>
            <div id="menu_load_bar"></div>
         </div>
         <div class="tab-pane fade" id="menu_files">
            <p>
            Check sheets
            <ul>
               <li><a href="excel/checksheet_wirestring_v1.5.xls">checksheet_wirestring_v1.5.xls</a>
               <li><a href="excel/wiretension_v1.0.xls">wiretension_v1.0.xls</a>
            </ul>
            </p>
            <p>
            Catalogs
            <ul>
               <li><a href="catalog/Luma-Cat.pdf">Sense wire (25um-phi) by LUMA</a>
               <li>Field wire (126um-phi) by Sinko
               <li><a href="catalog/dg_1003T.pdf">Dial Gauge (Mitsutoyo No. 1003T) at 10deg</a>
               <li><a href="catalog/dg_1045S.pdf">Dial Gauge (Mitsutoyo No. 1045S) at 90,180,270deg</a>
            </ul>
            </p>
         </div>
         <div class="tab-pane fade" id="menu_upload">
            <p>
            <h5>COMETCDC.xml</h5>
            <div id="upload-xml">
               <div class="form-group">
                  <input id="upload-form-file" name="file" size="20" type="file"/>
               </div>
               <progress id="progress_bar" value="0" max="100" style="display:none"></progress>
               <span id="progress_msg"></span>
            </div>
            </p>
            <hr/>
            <p>
            <h5>dial_gauge.csv / tension_bar.csv</h5>
            <form class="form-inline" id="upload-csv" method="post" enctype="multipart/form-data">
               <div class="form-group">
                  <input id="upload-form-file" name="file" size="20" type="file" accept="text/comma-separated-values" onchange="return upload('#upload-csv', '/csv_upload');"/>
               </div>
               <progress id="progress_bar" value="0" max="100" style="display:none"></progress>
               <span id="progress_msg"></span>
            </form>
            </p>

         </div>
      </div>
      </section>
      <script>
         $(function() {
            zipWrapper("#upload-xml #upload-form-file", function(blob) {
               var name = "#upload-xml";
               var url = "/zip_upload";
               $(name + " #progress_msg").show();
               $(name + " #progress_bar").attr("value", 0);
               $(name + " #progress_bar").show();
               $(name + " #upload-form-file").attr("disabled","disabled");
               console.log("starting ajax...");
               console.log("blog: " + blob)
               var fd = new FormData();
               fd.append("zip", blob);
               $.ajax({
                  url: url,
                  type: 'post',
                  processData: false,
                  contentType: false,
                  data: fd,
                  error: function (xhr, textStatus, errorThrown) {
                     console.log("there is error at ajax...");
                     console.log(xhr.responseText);
                  },
                  success: function(data) { 
                     $(name + " #progress_msg").html("done!").fadeOut("slow");
                     //$(name + " #progress_msg").hide();
                     $(name + " #upload-form-file").val("");
                     $(name + " #upload-form-file").removeAttr("disabled");
                     $(name + " #progress_bar").hide();
                     console.log(data); 
                  },
                  xhr : function() {
                     XHR = $.ajaxSettings.xhr();
                     if (XHR.upload){
                        XHR.upload.addEventListener('progress',function(e) {
                           progre = parseInt(e.loaded/e.total*10000)/100 ;
                           //console.log(progre+"%") ;
                           $(name + " #progress_msg").height("30px");
                           $(name + " #progress_msg").html("Uploading.. " + progre+"%");
                           $(name + " #progress_bar").attr("value", progre);
                        }, false); 
                     }
                     return XHR;
                  },
                });
             });
           });
       </script>
    </body>
</html>
